!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-Sortable requires a Window.");if(!("UI"in t))throw new Error("FrostUI-Sortable requires FrostUI.");t.Core;const e=t.dom,s=(t.QuerySet,t.UI),i=t.document;class r extends s.BaseComponent{constructor(t,e){super(t,e),this._selector=this._settings.items,this._settings.handle&&(this._selector+=" "+this._settings.handle),this._enabled=!this._settings.disabled,this._refreshCursors(),this._events()}dispose(){e.removeEventDelegate(this._node,"mousedown.ui.sortable"),e.removeEvent(this._node,"receive.ui.sortable"),e.remove(this._placeholder),this._target=null,this._placeholder=null,this._currentSortable=null,super.dispose()}disable(){return this._enabled=!1,this}enable(){return this._enabled=!0,this}isDropTarget(){return this._settings.dropOnEmpty||this.items().length}items(){return e.find(this._settings.items,this._node)}}Object.assign(r.prototype,{_events(){let t,s,i;e.addEventDelegate(this._node,"mousedown.ui.sortable",this._selector,e.mouseDragFactory(t=>{if(t.button||!this._enabled||e.is(t.currentTarget,this._settings.cancel))return!1;t.preventDefault(),this._target=this._findTarget(t.currentTarget)},r=>{t||(t=!0,i=e.index(this._target),s=i,e.triggerEvent(this._node,"start.ui.sortable",{detail:{target:this._target}}),this._buildPlaceholder(),this._initTarget(r.pageX,r.pageY),this._currentSortable=this._node),this._updateTarget(r.pageX,r.pageY);const l=this._findNearestSortable(r.pageX,r.pageY),a=e.isSame(this._node,l)?this.items():this.constructor.init(l).items(),n=this._findNearestItem(a,r.pageX,r.pageY);this._updatePlaceholder(n,r.pageX,r.pageY);const h=e.index(this._placeholder);e.isSame(l,this._currentSortable)?s!==h&&e.triggerEvent(l,"change.ui.sortable",{detail:{target:this._target,placeholder:this._placeholder}}):(e.triggerEvent(this._currentSortable,"remove.ui.sortable",{detail:{target:this._target,placeholder:this._placeholder}}),e.triggerEvent(l,"receive.ui.sortable",{detail:{target:this._target,placeholder:this._placeholder}})),s=h,this._currentSortable=l,this._settings.scroll&&this._checkScroll(r.pageX,r.pageY)},r=>{t?(r.preventDefault(),e.triggerEvent(this._currentSortable,"stop.ui.sortable",{detail:{target:this._target,placeholder:this._placeholder}}),e.setAttribute(this._target,"style",this._originalStyle),this._settings.helperClass&&e.removeClass(this._target,this._settings.helperClass),e.before(this._placeholder,this._target),e.remove(this._placeholder),s===i&&e.isSame(this._currentSortable,this._node)||e.triggerEvent(this._currentSortable,"update.ui.sortable",{detail:{target:this._target}}),this._target=null,this._placeholder=null,this._currentSortable=null,t=!1,i=null,s=null):this._target=null})),e.addEvent(this._node,"receive.ui.sortable",t=>{this._refreshCursors()})}}),Object.assign(r.prototype,{_checkScroll(s,r){let l=e.getScrollY(t),a=e.getScrollX(t);if(r<l+this._settings.scrollSensitivity)l=Math.max(0,l-this._settings.scrollSpeed);else if(r>l+e.height(t)-this._settings.scrollSensitivity){const t=e.height(i);l=Math.min(t,l-this._settings.scrollSpeed)}if(s<a+this._settings.scrollSensitivity)a=Math.max(0,a-this._settings.scrollSpeed);else if(s>a+e.width(t)-this._settings.scrollSensitivity){const t=e.width(i);a=Math.min(t,a-this._settings.scrollSpeed)}e.setScroll(a,l)},_findNearestItem(t,s,i){return t=t.filter(t=>!e.isSame(t,this._placeholder)),e.nearestTo(t,s,i,!0)},_findNearestSortable(t,s){if(!this._settings.connectWith)return this._node;const i=e.find(this._settings.connectWith).filter(t=>r.init(t).isDropTarget());return i.length?e.nearestTo([this._node,...i],t,s,!0):this._node},_findTarget(t){return this._settings.handle?this.items().find(s=>e.contains(s,t)):t},_refreshCursors(){const t=e.find(this._selector,this._node);e.setStyle(t,"cursor",this._settings.cursor)}}),Object.assign(r.prototype,{_buildPlaceholder(){const t=e.tagName(this._target);if(this._placeholder=e.create(t,{class:e.getAttribute(this._target,"class")}),this._settings.placeholderClass&&e.addClass(this._placeholder,this._settings.placeholderClass),this._settings.forcePlaceholderSize){const t=e.rect(this._target,!0);e.setStyle(this._placeholder,{width:t.width+"px",height:t.height+"px"})}},_initTarget(t,s){this._originalStyle=e.getAttribute(this._target,"style");const r=e.rect(this._target,!0);this._settings.forceHelperSize&&e.setStyle(this._target,{width:r.width+"px",height:r.height+"px"});let l=r.x,a=r.y;this._offsetX=t-l,this._offsetY=s-a;const n=e.findOne(this._settings.appendTo);let h;if(h=e.isSame(n,i.body)||"relative"!==e.css(n,"position")?e.closest(n,t=>"relative"===e.css(t,"position"),i.body).shift():n,h){const t=e.position(h,!0);this._offsetX+=t.x,this._offsetY+=t.y,l-=t.x,a-=t.y}e.setStyle(this._target,"position","absolute"),"y"===this._settings.axis?e.setStyle(this._target,"left",l):"x"===this._settings.axis&&e.setStyle(this._target,"top",a),this._settings.opacity&&e.setStyle(this._target,"opacity",this._settings.opacity),e.setStyle(this._target,"zIndex",this._settings.zIndex),this._settings.helperClass&&e.addClass(this._target,this._settings.helperClass),e.append(n,this._target)},_updatePlaceholder(t,s,i){const r=e.center(t,!0),l=e.center(this._placeholder,!0);let a;a="y"===this._settings.axis||r.x===l.x?i<r.y?"before":"after":"x"===this._settings.axis||r.y===l.y?s<r.x?"before":"after":s<r.x&&i<r.y?"before":"after",e[a](t,this._placeholder)},_updateTarget(t,s){if(!this._settings.axis||"y"===this._settings.axis){const t=s-this._offsetY;e.setStyle(this._target,"top",t+"px")}if(!this._settings.axis||"x"===this._settings.axis){const s=t-this._offsetX;e.setStyle(this._target,"left",s+"px")}this._settings.containment&&e.constrain(this._target,this._settings.containment)}}),r.defaults={appendTo:"body",axis:null,cancel:"input, textarea, button, select, option",connectWith:null,containment:null,cursor:"auto",disabled:!1,dropOnEmpty:!0,forceHelperSize:!0,forcePlaceholderSize:!0,handle:null,helperClass:null,items:":scope > li",opacity:.9,placeholderClass:"bg-light",zIndex:1e3,scroll:!0,scrollSensitivity:20,scrollSpeed:20},s.initComponent("sortable",r),s.Sortable=r}));