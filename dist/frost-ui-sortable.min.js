!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-Sortable requires a Window.");if(!("UI"in t))throw new Error("FrostUI-Sortable requires FrostUI.");const e=t.Core,s=t.dom,i=(t.QuerySet,t.UI),r=t.document;class l extends i.BaseComponent{constructor(t,e){super(t,e),this._selector=this._settings.items,this._settings.handle&&(this._selector+=" "+this._settings.handle),this._enabled=!this._settings.disabled,this._refreshCursors(),this._events()}disable(){return this._enabled=!1,this}dispose(){s.removeEventDelegate(this._node,"mousedown.ui.sortable"),s.removeEvent(this._node,"receive.ui.sortable"),s.remove(this._placeholder),this._target=null,this._placeholder=null,this._currentSortable=null,super.dispose()}enable(){return this._enabled=!0,this}isDropTarget(){return this._settings.dropOnEmpty||this.items().length}items(){return s.find(this._settings.items,this._node)}}Object.assign(l.prototype,{_events(){const t=e.animation(t=>{s.hide(this._target),this._checkScroll(t.x,t.y),s.show(this._target)});let i,r,l;s.addEventDelegate(this._node,"mousedown.ui.sortable touchstart.ui.sortable",this._selector,s.mouseDragFactory(t=>{if(t.button||!this._enabled||s.is(t.currentTarget,this._settings.cancel))return!1;t.preventDefault(),this._target=this._findTarget(t.currentTarget)},e=>{const h=(t=>"touches"in t&&t.touches.length?{x:t.touches[0].pageX,y:t.touches[0].pageY}:{x:t.pageX,y:t.pageY})(e);i||(i=!0,l=s.index(this._target),r=l,s.triggerEvent(this._node,"sort.ui.sortable",{detail:{target:this._target}}),this._buildPlaceholder(),this._initTarget(h.x,h.y),this._currentSortable=this._node),this._updateTarget(h.x,h.y);const o=this._findNearestSortable(h.x,h.y),n=s.isSame(this._node,o)?this.items():this.constructor.init(o).items(),a=this._findNearestItem(n,h.x,h.y);if(!a)return;this._updatePlaceholder(a,h.x,h.y);const _=s.index(this._placeholder);s.isSame(o,this._currentSortable)?r!==_&&s.triggerEvent(o,"sorting.ui.sortable",{detail:{target:this._target,placeholder:this._placeholder}}):(s.triggerEvent(this._currentSortable,"send.ui.sortable",{detail:{target:this._target,placeholder:this._placeholder}}),s.triggerEvent(o,"receive.ui.sortable",{detail:{target:this._target,placeholder:this._placeholder}})),r=_,this._currentSortable=o,this._settings.scroll&&t(h)},t=>{i?(t.preventDefault(),s.triggerEvent(this._currentSortable,"sorted.ui.sortable",{detail:{target:this._target,placeholder:this._placeholder}}),s.setAttribute(this._target,"style",this._originalStyle),this._settings.helperClass&&s.removeClass(this._target,this._settings.helperClass),s.before(this._placeholder,this._target),s.remove(this._placeholder),r===l&&s.isSame(this._currentSortable,this._node)||s.triggerEvent(this._currentSortable,"update.ui.sortable",{detail:{target:this._target}}),this._target=null,this._placeholder=null,this._currentSortable=null,i=!1,l=null,r=null):this._target=null})),s.addEvent(this._node,"receive.ui.sortable",t=>{this._refreshCursors()})}}),Object.assign(l.prototype,{_checkScroll(e,i){let l=s.getScrollY(t),h=s.getScrollX(t);if(i<l+this._settings.scrollSensitivity)l=Math.max(0,l-this._settings.scrollSpeed);else if(i>l+s.height(t)-this._settings.scrollSensitivity){const t=s.height(r,DOM.SCROLL_BOX);l=Math.min(t,l+this._settings.scrollSpeed)}if(e<h+this._settings.scrollSensitivity)h=Math.max(0,h-this._settings.scrollSpeed);else if(e>h+s.width(t)-this._settings.scrollSensitivity){const t=s.width(r,DOM.SCROLL_BOX);h=Math.min(t,h+this._settings.scrollSpeed)}s.setScroll(r,h,l)},_findNearestItem(t,e,i){return t=t.filter(t=>!s.isSame(t,this._placeholder)),s.nearestTo(t,e,i,!0)},_findNearestSortable(t,e){if(!this._settings.connectWith)return this._node;const i=s.find(this._settings.connectWith).filter(t=>l.init(t).isDropTarget());return i.length?s.nearestTo([this._node,...i],t,e,!0):this._node},_findTarget(t){return this._settings.handle?this.items().find(e=>s.hasDescendent(e,t)):t},_refreshCursors(){const t=s.find(this._selector,this._node);s.setStyle(t,"cursor",this._settings.cursor)}}),Object.assign(l.prototype,{_buildPlaceholder(){const t=s.tagName(this._target);if(this._placeholder=s.create(t,{class:s.getAttribute(this._target,"class")}),this._settings.placeholderClass&&s.addClass(this._placeholder,this._settings.placeholderClass),this._settings.forcePlaceholderSize){const t=s.rect(this._target,!0);s.setStyle(this._placeholder,{width:t.width+"px",height:t.height+"px"})}s.before(this._target,this._placeholder)},_initTarget(t,e){this._originalStyle=s.getAttribute(this._target,"style");const i=s.rect(this._target,!0);this._settings.forceHelperSize&&s.setStyle(this._target,{width:i.width+"px",height:i.height+"px"});let l=i.x,h=i.y;this._offsetX=Math.abs(l-t),this._offsetY=Math.abs(h-e);const o=s.findOne(this._settings.appendTo);let n;if(n=s.isSame(o,r.body)||"relative"!==s.css(o,"position")?s.closest(o,t=>"relative"===s.css(t,"position"),r.body).shift():o,n){const t=s.position(n,!0);this._offsetX+=t.x,this._offsetY+=t.y,l-=t.x,h-=t.y}s.setStyle(this._target,"position","absolute"),"y"===this._settings.axis?s.setStyle(this._target,"left",l):"x"===this._settings.axis&&s.setStyle(this._target,"top",h),this._settings.opacity&&s.setStyle(this._target,"opacity",this._settings.opacity),s.setStyle(this._target,"zIndex",this._settings.zIndex),this._settings.helperClass&&s.addClass(this._target,this._settings.helperClass),s.append(o,this._target)},_updatePlaceholder(t,e,i){const r=s.center(t,!0),l=s.center(this._placeholder,!0);let h;h="y"===this._settings.axis||r.x===l.x?i<r.y?"before":"after":"x"===this._settings.axis||r.y===l.y?e<r.x?"before":"after":e<r.x&&i<r.y?"before":"after",s[h](t,this._placeholder)},_updateTarget(t,e){if(!this._settings.axis||"y"===this._settings.axis){const t=e-this._offsetY;s.setStyle(this._target,"top",t+"px")}if(!this._settings.axis||"x"===this._settings.axis){const e=t-this._offsetX;s.setStyle(this._target,"left",e+"px")}this._settings.containment&&s.constrain(this._target,this._settings.containment)}}),l.defaults={appendTo:"body",axis:null,cancel:"input, textarea, button, select, option",connectWith:null,containment:null,cursor:"auto",disabled:!1,dropOnEmpty:!0,forceHelperSize:!0,forcePlaceholderSize:!0,handle:null,helperClass:null,items:":scope > li",opacity:.9,placeholderClass:"bg-light",zIndex:1e3,scroll:!0,scrollSensitivity:20,scrollSpeed:20},i.initComponent("sortable",l),i.Sortable=l}));